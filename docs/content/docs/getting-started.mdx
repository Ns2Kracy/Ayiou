---
title: 快速开始
description: 开始使用 Ayiou 框架构建你的 Bot
---

## 安装

在你的 `Cargo.toml` 中添加依赖：

```toml
[dependencies]
ayiou = { git = "https://github.com/Ns2Kracy/Ayiou.git" }
async-trait = "0.1"
anyhow = "1.0"
tokio = { version = "1", features = ["full"] }
```

## 基本用法

Ayiou 使用结构体 (**Struct**) 来定义插件。每个插件都需要实现 `execute` 方法来处理逻辑。

### 1. 定义插件

使用 `#[derive(Plugin)]` 宏定义插件结构：

```rust
use ayiou::prelude::*;

#[derive(Plugin)]
#[plugin(name = "hello", command = "hello", description = "打招呼")]
pub struct HelloPlugin;

impl HelloPlugin {
    // 必须实现 execute 方法，接受 &Ctx
    pub async fn execute(&self, ctx: &Ctx) -> anyhow::Result<()> {
        let user_id = ctx.user_id();
        ctx.reply_text(format!("你好，用户 {}！", user_id)).await?;
        Ok(())
    }
}
```

### 2. 处理参数

目前框架不自动解析参数，你需要从 `ctx.text()` 手动解析。

```rust
#[derive(Plugin)]
#[plugin(name = "echo", command = "echo", description = "复读机")]
pub struct EchoPlugin;

impl EchoPlugin {
    pub async fn execute(&self, ctx: &Ctx) -> anyhow::Result<()> {
        let text = ctx.text();

        // 解析参数：除去命令本身
        // 假设消息是 "/echo hello world"
        // 简单的示例：
        let content = text.split_whitespace()
            .skip(1)
            .collect::<Vec<_>>()
            .join(" ");

        if content.is_empty() {
            ctx.reply_text("请输入要复读的内容").await?;
            return Ok(());
        }

        ctx.reply_text(format!("你说的是：{}", content)).await?;
        Ok(())
    }
}
```

### 3. 正则匹配

你也可以使用正则表达式来匹配消息：

```rust
#[derive(Plugin)]
#[plugin(name = "url_detector", regex = r"https?://\S+")]
pub struct UrlDetector;

impl UrlDetector {
    pub async fn execute(&self, ctx: &Ctx) -> anyhow::Result<()> {
        let text = ctx.text();
        // 使用 self.regex() 获取编译好的正则
        if let Some(mat) = self.regex().find(&text) {
             ctx.reply_text(format!("发现链接: {}", mat.as_str())).await?;
        }
        Ok(())
    }
}
```

### 4. 注册并运行

在 `main` 函数中注册插件：

```rust
#[tokio::main]
async fn main() {
    let bot = AyiouBot::new()
        .plugin::<HelloPlugin>()
        .plugin::<EchoPlugin>()
        .plugin::<UrlDetector>();

    // 连接到 OneBot 适配器
    bot.run("ws://127.0.0.1:8080").await;
}
```

## 常用 Context API

`Ctx` 对象提供了与平台交互的方法：

- `ctx.text() -> String`: 获取消息文本
- `ctx.user_id() -> i64`: 获取用户 ID
- `ctx.group_id() -> Option<i64>`: 获取群组 ID
- `ctx.reply_text("...")`: 回复文本
- `ctx.send_group_msg(group_id, "...")`: 发送群消息
- `ctx.set_group_ban(group_id, user_id, duration)`: 群禁言
